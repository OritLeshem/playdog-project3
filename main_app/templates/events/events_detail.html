{% extends 'base.html' %}
{% block content%}
{% load static %}

<div><h1 class='form-h1'>{{ event.name}}</h1></div> 
    <div class='img-div'><img id='logo' src="{% static 'img/logo.png' %}"></div>


        <p id='age'> {{ event.date }}</p>
        <p id='age'> {{ event.time }}</p>
        <p id='breed'>{{ event.location }}</p>
        <div id="map"></div>

        <p id='age'>{{ event.description }}</p>
        <br>
        <hr>
        <br>
        <p id='age'> Attending:</p> 

        {% if event.attendees.count > 0 %}
        <p id='age'>Click to Add/Remove Your Dog(s)</p>


        {% for attendee in event.attendees.all %}  

        
    {% if user != attendee.user %}

    <div class='center'>           
        <form class="icon" action="{% url 'detail' attendee.id %}" method="post">
            {% csrf_token %}    
            <button type="submit" class="btn-add-remove"><img id='dog-pic-icon' src="{{ attendee.image.url }}"></button>
            <p id='breed'>{{ attendee.name}}</p>
        </form>
    </div> 
        {% else %}
        <div class='center'>           
            <form class="icon" action="{% url 'unassoc_dog' event.id attendee.id %}" method="post">
                {% csrf_token %}    
                <button type="submit" class="btn-add-remove"><img id='dog-pic-icon' src="{{ attendee.image.url }}"></button>
                <p id='breed'>{{ attendee.name}}</p>
            </form>
        </div> 
    {% endif %}

        {% endfor %}

        {% else %}
        <p id='age'>No Play Dogs Currently Attending</p>
        {% endif %}
        {% if my_dogs.count %}
        
        <p id='age'> My Dogs:</p>
        <p id='age'>Click to Add/Remove Your Dog(s)</p>
        {% for dog in my_dogs %}
        {% if dog in dogs_not_attending %}
    <div class='center'>           
            <form class="icon" action="{% url 'assoc_dog' event.id dog.id %}" method="post">
                {% csrf_token %}    
                <button type="submit" class="btn-add-remove"><img id='dog-pic-icon' src="{{ dog.image.url }}"></button>
                <p id='breed'>{{ dog.name }}</p>
            </form>
    </div> 

        {% endif %}

                {% endfor %}
                {% else %}

        {% endif %}    

        <br>


{% if user == event.user %}
        <div class='btn-contain'>       
                <a class='btn' href="{% url 'events_update' event.id %}">Edit Event</a> 
                <a class='btn' href="{% url 'events_delete' event.id %}">Delete Event</a>       
        </div>  
{% endif %}


<script>
    $( function() {
      $( "#datepicker" ).datepicker();
      } );




let latitude = parseFloat("{{event.lat}}");
let longitude = parseFloat("{{event.lng}}");

console.log(typeof latitude);
console.log(typeof longitude);

console.log(latitude);
console.log(longitude);




var mymap = L.map('map').setView([latitude, longitude], 16);
L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoidXdpdGRhdCIsImEiOiJja3AzMTQ3eWYwMnJ3Mm5wdGg2a3M1dmhsIn0.BqTd3qhSHwmC6UMyiHFczw'
    }).addTo(mymap);

 let eventMarker = new L.marker([latitude, longitude]);
 eventMarker.addTo(mymap);



// var eventMarker;


// function onMapClick(e) {
//     if (!eventMarker){
//         eventMarker = new L.marker(e.latlng, {draggable: 'true', autoPan: 'true'});
//         latitude = e.latlng.lat.toFixed(6);
//         longitude = e.latlng.lng.toFixed(6);
//         eventMarker.on('click', function(e){
//             var marker = e.target;
//             var postion = marker.getLatLng();
//             marker.setLatLng(new L.LatLng(position.lat, position.lng), {draggable: 'true', autoPan: 'true'});
//             mymap.panTo(new L.LatLng(position.lat, position.lng))
//             eventMarker = marker;

//           });
//           mymap.addLayer(eventMarker);

//     }
//     else {
//         eventMarker.setLatLng(e.latlng);
//         latitude = e.latlng.lat.toFixed(6);
//         longitude = e.latlng.lng.toFixed(6);


//       }
//       console.log(latitude)
//       console.log(longitude)

// };
// mymap.on('click', onMapClick);



  </script>

        {% endblock %}